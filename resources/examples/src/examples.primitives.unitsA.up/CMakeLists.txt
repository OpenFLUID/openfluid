CMAKE_MINIMUM_REQUIRED (VERSION 2.6)

INCLUDE(CMake.in.config)

PROJECT(${FUNC_ID} CXX)

IF(NOT openfluid_FOUND)
  FIND_PACKAGE(PkgConfig REQUIRED)
  PKG_CHECK_MODULES(openfluid openfluid)
ENDIF(NOT openfluid_FOUND)

IF(openfluid_FOUND) 

INCLUDE_DIRECTORIES(${openfluid_INCLUDE_DIRS})
LINK_DIRECTORIES(${openfluid_LIBRARY_DIRS})
  
# process fortran source files if present 
IF(FUNC_FORTRAN)
  ENABLE_LANGUAGE(Fortran)
  SET(CMAKE_Fortran_FLAGS_RELEASE "-funroll-all-loops -fno-f2c -O3")
  SET(FORTRAN_LINK_LIBS "gfortran")
ENDIF(FUNC_FORTRAN)


ADD_LIBRARY(${FUNC_ID}_ofware-func MODULE ${FUNC_CPP} ${FUNC_FORTRAN})
ADD_DEFINITIONS(-DOPENFLUID_VERSION=${openfluid_VERSION})
ADD_DEFINITIONS(${openfluid_CFLAGS})
SET_TARGET_PROPERTIES(${FUNC_ID}_ofware-func PROPERTIES PREFIX "" SUFFIX "${CMAKE_SHARED_LIBRARY_SUFFIX}")
TARGET_LINK_LIBRARIES(${FUNC_ID}_ofware-func ${openfluid_LIBRARIES} ${FORTRAN_LINK_LIBS})

IF(INSTALL_PATH)
  INSTALL(TARGETS ${FUNC_ID}_ofware-func DESTINATION "${INSTALL_PATH}")
ENDIF(INSTALL_PATH)  

ENDIF(openfluid_FOUND)